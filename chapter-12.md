# Structure Computation

本章讲述如何在已知基本矩阵$F$和两幅图像中若干对对应点$x \leftrightarrow x^{'}$的情况下计算三维空间点$X$的位置。

## 12.1 问题概述

我们假设已知摄像机矩阵$P,P^{'}$,基本矩阵$F$和两幅图像中若干对对应点$x \leftrightarrow x^{'}$，因为有噪声的存在，图像中的点反投影回去的两条射线不一定相交，$xFx^{'}$也不一定等于0，所以简单三角化不一定可行。

我们先回忆一下第10章三维重建的知识。我们介绍了好几种不同种类的三维重建(取决于我们到底对摄像机矩阵了解多少)。那么结合本章的三角化，我们希望三角化在不同种类的重建之间能给出同样的结果。所以我们首先用$\tau$来代表三角化的过程，我们说如果$\tau$能满足下式，那么我们就说三角化在变换$H$下是不变的：
$$
\tau(x,x^{'},P,P^{'}) = H^{-1}\tau(x,x^{'},P H^{-1},P^{'} H^{-1})
$$

为什么需要讨论这个？这是因为我们首先需要确定三维重建的种类，才能决定优化目标长什么样。如果我们只知道摄像机矩阵是一个projective matrix，那么我们就不能在三维空间优化目标函数。因为这样的优化函数在投影变换中不能给出唯一的结果。所以本章给出的三角化方法优化的是二维图像上的距离，所以本章的方法是在投影变换（projective transformation）中是不变的。


## 12.2 线性三角化方法

对于两幅图像，我们分别有$x=PX,x^{'}=PX^{'}$,我们可以将第一个方程改成$x \times PX=0$，第二幅图也一样。
我们继续改写就可以有$AX=0$。

**Homogeneous method** 找出$A$最小特征值对应的特征向量

**Inhomogeneous method** 参见4.1.2节，原书P90

**讨论**
Inhomogeneous method假设点不在无穷远处，不适合projective reconstruction. 其实这两个方法都不适合。

Inhomogeneous method适合affine reconstruction
Homogeneous method不适合affine reconstruction

## 12.3 几何损失函数

由于图像中有噪声的存在，$x \leftrightarrow x^{'}$ 其实不能满足基本矩阵的性质，我们用$\bar{x},\bar{x'}$表示没有噪声的点。那么我们可以构建以下优化函数

$$
C(x,x') = d(x,\hat{x})^2 + d(x',\hat{x}')^2 
\\
\hat{x'}F\hat{x} = 0
$$


##  Sampson approximation

我们定义$X$与$\hat{X}$之间的插差为$\delta_X$

$$
\delta_X = -J^T(JJ^T)^{-1} \epsilon
$$

其中

$$
\epsilon = x'^{T}Fx
$$

$$
J = \partial \epsilon/ \partial x
$$

所以我们可以看出该差值其实是基本矩阵方程关于$x$的导数
那么$X$和$\hat{X}$之间的关系可以写成

$$
\hat{X} = X + \delta_X
$$

我们只需要把$\delta_X$算出来，然后对计算出的理论点$X$按照上式进行一个纠正就可以了。

## 12. 5 三角化的全局最优解

本节我们介绍一种可以找到全局最优解的优化函数,并且是非迭代的. 我们同时假设噪声服从高斯分布.

## 12.5.1 问题梳理

我们知道第一幅图的极点一定在极线上。第二幅图的极点也满足这个性质。反过来，在极线上的点也满足基本矩阵的约束。那么我能就让观测到的点尽可能的靠近极线，也就是找观测点到极线的距离，并使其最小。

所以我们就可以构建出以下损失函数
$$
d(x,l)^2 + d(x'+l')^2
$$

我们的策略如下:

1. 将极线方程参数化,所以第一幅图像中的极线方程就可以写为l(t)
2. 利用基本矩阵$F$,和$l(t)$来计算第二幅图像中的极线l'(t)
3. 将损失函数写成d(x,l(t))^2 + d(x'+l'(t))^2 
4. 求解最优的$t$

## 12.5.2 一些需要注意的细节

首先, 两幅图中对应点都不能与极点重合
第二, 我们可以对两幅图都做一个刚体变换,那么$x,x'$就可以被放置在原点$(0,0,1)$, 那么两幅图的极点分别是$(1,0,f),(1,0,f')$. 我们知道极点也是要满足$F$的,所以我们有$F(1,0,f)^T = (1,0,f')F = 0$, 如此以来我们就可以把基本矩阵表示为一种特殊形式
$$
F = \left[
    \begin{matrix}
    ff'd & -f'c & -f'd \\
    -fb  & a    & b\\
    -fd  & c    & d
    \\
    \end{matrix}
    \right]
$$

同时我们也知道极线会通过极点$(1,0,f)$,我们再找一个特殊点, 那就是极线与$y$轴的交点 $(0,t,1)$, 所以极线就可以写成$(1,0,f) \times (0,t,1) = (tf,1,-t)$, 那么该直线到原点的距离就是
$$
d(x,l(t))^2 = \frac{t^2}{1+(tf)^2}
$$






