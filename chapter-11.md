# 基本矩阵 $F$
本章讲述如何用数值方法在已知若干对应点的情况下求解基本矩阵 $F$

## 11.1 基本知识

基本矩阵定义如下
$$ 
 x^{'T} F x = 0 
$$

定义 $\bold{x} = (x,y,1)^{T}$，$\bold{x^{'}} = (x^{'},y^{'},1)^{T}$
。带入基本矩阵的定义并整理可以得到一个方程组，记为$Af = 0$。具体形式参见书 279页


解析解：$A$的rank如果是8，那么直接求方程组的特解就可以。但是一般情况下有噪声，所以$A$的rank有可能是9，那么就用SDV分解。可以表达成$A=UDV^{T}$，那么$f$ 就是$V$的最后一列.

### 11.1.1 奇异性约束
$F$是一个奇异矩阵，rank为2. 利用这个性质，我们可以先用解析解求出一个$F$, 然后分解为$F=UDV^{T}$,进一步写成$F=Udiag(r,s,t)V^{T}$, 接着把$t$换成0就可以了。利用解析解求$F$的时候需要8组对应点，所以这个方法叫8点法

### 11.1.2 已知7个对应点怎么办
求解$Af=0$,然后选基础解系中的两个特解$f_1,f_2$ （书中叫零空间，null space），然后构造一个方程$\alpha f_1 + (1-\alpha )f_2$, 再利用$F$是奇异矩阵的性质，得到$det(\alpha f_1 + (1-\alpha )f_2) = 0$. 解这个方程就可以得到$\alpha$

## 11.2 正交化的8点法

把8个点的质心平移到原点,把点看成一个向量,然后把向量模长归一化.

## 11.3 数值最优化

优化目标: 找到一个$F$, 使得$||Af||$最小,且满足 $||f||=1$ 且 $det F=0$
步骤如下:

1. 通过8点法找初始值$F_0$, 然后找到$F_0$的零向量$e_0$
2. 记$e_0 = e_i$, 通过 $e_i$ 构造 $E_i$
   $$
   E_0 = \left[
         \begin{matrix}
          e_0 & 0   & 0 \\
          0   & e_0 & 0 \\
          0   & 0   & e_0 \\
         \end{matrix}
         \right] 
   $$
3. 设 $f_i=E_i m_i$ 用 595 页的算法求解优化目标
4. 计算误差 $\epsilon_i = A f_i$
5. 利用600页Levenberg–Marquardt算法改变$e_i$
6. 重复1到5步直到算法收敛

## 11.4 几何损失函数

本章主要介绍如何用几何损失函数来计算基本矩阵。

### 11.4.1 黄金法则 （Gold Standard method）

我们假设图像噪声服从高斯分布，那么我们优化下式：
$$
\Sigma_i d(x_i,\hat{x})^2 + d(x_i^{'},\hat{x}^{'})^2
$$

$x_i \leftrightarrow x^{'}_i$是已知对应点。$\hat{x},\hat{x}^{'}$是没有噪声的点。

优化步骤如下：
1. 根据含有噪声的点$x_i,x^{'}_i$估计出一个初始的$\hat{F}$
2. 根据$\hat{F}$求出$e^{'}$ (回忆基本矩阵定义 $F=[e']_{\times}P^{'}P^{+}$),然后构造 $P=[I|0],P^{'}=[[e']_{\times}\hat{F}|e^{'}]$
3. 根据$x_i \leftrightarrow x^{'}_i$ 还有$\hat{F}$,用三角化求出空间点$\hat{X}$
4. 根据$\hat{X}$有以下两式成立 $\hat{x_i} = P\hat{X}, \hat{x_i}^{'} = P^{'}\hat{X}$
5. 把上两式带入优化目标

### 11.4.2 参数化基本矩阵

非线性优化要求把$F$参数化，下面介绍几种方法。

1. Over-parametrization. 把$F$写成$F=[t]_{\times}M$ M是任意的$3 \times 3$ 矩阵
2. Epipolar parametrization. 把$F$ 第三列写成前两列的线性组合
3. Both epipoles as parameters，参见书p286 11.8式

### 11.4.3  First-order geometric error (Sampson distance)

Sampson distance以 $x^{'} F x_{i}=0$为优化目标，将其写成：
$$
\frac{(x^{'} F x_{i})^2}{(Fx_i)^2_1 + (Fx_i)^2_2 + (Fx^{'}_i)^2_1 + (Fx^{'}_i)^2_1}
$$

$(Fx_i)^2_j$ 代表 $Fx_i$的第$j$个元素

**Symmetric epipolar distance**

以 $x^{'} F x_{i}=0$为优化目标，那么我们可以让$x^{'}$尽可能靠近 $F x_{i}$.所以就有以下损失函数
$$
\Sigma d(x^{'},Fx_i)^2 +  d(x,Fx_i^{'})^2
$$

## 11.5 对各种损失函数的实验结果
sss


