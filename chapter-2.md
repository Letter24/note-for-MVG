# 投影几何与二维空间变换

本章主要介绍本书必要的几何知识与符号

## 2.2 2D投影平面

**行向量与列向量** 本书默认所有向量的都是列向量, 比如$x$, 那么$x^T$就是行向量. 对于一个行向量$(x,y)$, 我们就有$x=(x,y)^T$.

### 2.2.1 点和线

**线段的齐次坐标** 线是由方程$ax+by+c=0$组成的, 所以我们就用$(a,b,c)^T$来表示线段. 但是$(a,b,c)^T$不能唯一表示一条线段, 因为$(a,b,c)^T$与$k(a,b,c)^T$表示一样的线段 ($k$不能为0). 那么$k(a,b,c)^T$其实就是一类向量的表达. 这个类中所有的向量都是其次向量. 那么我们把所有的类都放在一起, 就形成了投影空间. 空间中有一个特殊点$(0,0,0)^T$, 它不属于任何直线.

**点的其次坐标** 直线方程是$ax+by+c=0$, 那么可以写成$(x,y,1)(a,b,c)^T$, 那么这个$(x,y,1)$就是点的齐次坐标.

**结论2.1** 点在直线上当且仅当$x^T l = 0$

**自由度** 自由度就是这个几何体可以由几个自由变化的变量来表达, 比如点的自由度就是2, 因为指定$x,y$就够了, 线的自由度也是2, 这是因为虽然线有三个变量, 但是他们之间的比例是$a:b:c$. 类似线性无关的变量的个数.

**直线的交点** 两个直线$l=(a,b,c), l'=(a',b',c')$, 他们的交点就是$l \times l'$

**两个点确定的直线** 两个点$x,x'$, 他们确定的直线就是$x \times x'$

## 2.2.2 理想点(ideal point)和无穷远处的直线

**平行线的交点** 如果我们考虑两个平行线的交点$ax+by+c=0,ax+by+c'=$, 做叉乘, 我们会得到$(c'-c)(b,-a,0)$, 如果我们忽略尺度因子$(c'-c)$, 那么平行线的交点就在$(b,-a,0)$, 我们再把这个齐次坐标变成非齐次, 那么就得到$(b/0,-a/0)$, 这点就在无穷远处, 所以我们说平行线就是在无穷远处相交.

**理想点与无穷远的直线** 我们考虑任一个点$(x_1,x_2,x_3)$, 把$x_3=0$, 那么$(x_1,x_2,0)$就是无穷远处的所有点, 这些点都落在一个直线上, 那就是$l_{\infty}=(0,0,1)$.

我们紧接着考虑任意一条直线$l=(a,b,c)$, $l$与$l_{\infty}$的交点就是$(-b,a)$, $(-b,a)$和直线的法向量$(a,b)$是垂直的, 所以他就是直线的方向. 注意$(a,b)$不是直线的方向, $(a,b)$和直线是垂直的. $(-b,a,0)$这个点在无穷远直线上, 那么无穷远处的直线就可以被看做是直线方向的集合.

**二维投影平面的几何模型** (可以先把书翻到p29 看fig2.1) 投影平面可以想象为三维空间中射线的集合. 可以从三个射线上挑出三个点, 并且让他们共面, 那么其他的射线都与该平面有交点. 所以该平面就是由射线上的点组成的. 射影平面上的线就是过原点的平面和射影平面的交点. 任意两个不同射线处于同一平面上, 任意两个不同的平面相较于一个射线. 可以类比两直线交于一点,两点确定一直线.  

最后一点, 无穷远处的理想点和直线平行于平面$x_3=1$

**线段与点的对偶性** 点与线段的角色其实可以是互换的. 比如说$l^T x=0$ 可以写成$x^T l = 0$

## 2.2.3 圆锥和对偶圆锥 
圆锥描述了平面上的二次方程. 欧氏几何主要三种:抛物线, 双曲线, 椭圆. 在二维摄影几何里, 这三种都是等价的.

我们首先把圆锥写成其次表达式 $x=(x_1,x_2,x_3)$

$$
\left[ 
\begin{matrix}
    a & b/2 & d/2 \\
    b/2& c & e/2 \\
    d/2 & e/2 & f
\end{matrix}
\right]
$$

圆锥就可以写成$x^TCx=0$ 圆锥有五个自由度

**五个点确定一个圆锥** 我们把圆锥换一个方式写,用$x=x_1/x_3,y=x_2/x_3$, 可以得到:
$$
(x_i^2, x_i y_i y_i^2 x_i y_i 1)c=0\\
c=(a,b,c,e,d,f)
$$

需要五个方程解出$c$,因为$c$的自由度是5

**和椭圆相切的直线**, 直线就是$l=cx$

**对偶圆锥** 在前文中$c$定义的圆锥是点组成的圆锥. 我们可以定义一个由直线组成的圆锥$c^*$, 这个圆锥就是由所有和$c$相切的直线组成的. $c^*=c^{-1}$

## 2.3 投影变换

**定义2.9** 投影变换$h$是一个从二维投影空间到二维投影空间的变换, 它满足一个性质: 如果$x_1,x_2,x_3$变换前在一条直线上当且仅当变换后的他们$(h(x_1),h(x_2),h(x_3))$还在一条直线上.

根据这个定义, 投影变换也叫共线性. 投影变换和单应性是同一个意思

书中还介绍了另外一种从代数角度来定义的办法. 我觉得原书中写的比较拗口, 通俗来说就是任何一个$3 \times 3$的非奇异矩阵$H$都定义了一个投影变换

从几何角度来解释, 投影变换其实定义了一个平面到平面的映射, 因为我们知道,投影几何的就是由平面定义的. 而且前文也说了, 投影变换保持了共线性. 如果说这两个平面上的坐标系都是欧式坐标系. 那么这个投影变换就变成了6个自由度的透视变换.

## 2.3.1 线段和圆锥的变换
我们直接上结果: 一个点有如下变换$x'=Hx$,那么线变换就是$l'=H^{-T} l$, 圆锥变换就是$x^TCx = x'^T H^{-T}CH^{-1}x'$, 所以$C=H^{-T}CH^{-1}$, 其对偶圆变换就是$C*'=HC^{*}H^T$

## 2.4 投影变换的种类

本节时一个重点章节

### 2.4.1 刚体变换

其形式如下
$$
\left(
\begin{matrix}
x' \\
y' \\
1
\end{matrix}
\right)
=

\left[
    \begin{matrix}
    \epsilon \cos \theta & -\sin & t_x \\
    \epsilon \sin \theta & -\cos & t_y \\
    0 & 0 & 1
    \end{matrix}

\right]

\left(
    \begin{matrix}
    x\\
    y\\
    1
    \end{matrix}

\right)

$$

可以简写成
$$
x'
=
\left[
    \begin{matrix}
    R & t   \\
    0^T & 1 \\
    \end{matrix}
\right]
x
$$

$R$是一个$2 \times 2$的正交矩阵, 整个大矩阵有三个自由度, 旋转一个, 平移两个. 不变量是: 线段长度, 线段之间角度, 图形的面积

## 2.4.2 相似变换

其形式如下:

$$
\left(
\begin{matrix}
x' \\
y' \\
1
\end{matrix}
\right)
=

\left[
    \begin{matrix}
    s \cos \theta & -s \sin & t_x \\
    s \sin \theta & s \cos & t_y \\
    0 & 0 & 1
    \end{matrix}

\right]

\left(
    \begin{matrix}
    x\\
    y\\
    1
    \end{matrix}

\right)
$$

可以简写成
$$
x'
=
\left[
    \begin{matrix}
    sR & t   \\
    0^T & 1 \\
    \end{matrix}
\right]
x
$$

整个矩阵四个自由度:缩放因子一个,旋转一个,平移两个. 其不变量是: 线段之间角度, 平行线还是平行的, 线段之间的比例不变, 因为是对整个图形进行缩放. 不同区域之间的面积也不变.

## 2.4.3 仿射变换


$$
\left(
\begin{matrix}
x' \\
y' \\
1
\end{matrix}
\right)
=

\left[
    \begin{matrix}
    a_{11} & a_{12} & t_x \\
    a_{21} & a_{22} & t_y \\
    0 & 0 & 1
    \end{matrix}

\right]

\left(
    \begin{matrix}
    x\\
    y\\
    1
    \end{matrix}

\right)
$$

可以简写成
$$
x'
=
\left[
    \begin{matrix}
    A & t   \\
    0^T & 1 \\
    \end{matrix}
\right]
x
$$
整个矩阵六个自由度. 左上角$A$四个, 平移两个.

$A$可以被分解成如下形式:
$$
A=R(\theta) R(-\phi) D R(\phi) 
$$

$$
\left[
\begin{matrix}
\lambda_1 & 0 \\
0 & \lambda_2
\end{matrix}
\right]
$$

所以$A$可以被解释为先旋转一个角度$\phi$, 再从$x,y$两个方向进行缩放,其比例因子为$\lambda_1, \lambda_2$, 再按$-\phi$旋转回去, 再转一个$\theta$

由于进行了压缩, 那么线段之间的角度就变了, 只能是保持直线之间的平行性, 直线之间比例, 面积的比例.

## 投影变换

$$
x'
=
\left[
    \begin{matrix}
    A & t   \\
    v^T & v \\
    \end{matrix}
\right]
x
$$

整个大矩阵8个自由度. 其不变量只能是直线变换以后还是直线.
